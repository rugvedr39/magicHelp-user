{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@angular/common\";\nfunction LevelDataComponent_div_3_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\", 10);\n    i0.ɵɵtext(2, \"Loading level details...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction LevelDataComponent_div_3_ng_template_6_tr_20_button_18_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵlistener(\"click\", function LevelDataComponent_div_3_ng_template_6_tr_20_button_18_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const detail_r6 = i0.ɵɵnextContext().$implicit;\n      const ctx_r8 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r8.confirmPayment(detail_r6._id));\n    });\n    i0.ɵɵtext(1, \"Confirm Payment\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LevelDataComponent_div_3_ng_template_6_tr_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\");\n    i0.ɵɵtemplate(18, LevelDataComponent_div_3_ng_template_6_tr_20_button_18_Template, 2, 0, \"button\", 14);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const detail_r6 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detail_r6.utrNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 8, detail_r6.amount, \"INR\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(detail_r6.status);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(10, 11, detail_r6.date, \"short\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(detail_r6.PayerInfo.username);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detail_r6.PayerInfo.email);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(detail_r6.PayerInfo.mobileNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", detail_r6.status === \"pending\");\n  }\n}\nfunction LevelDataComponent_div_3_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 11)(1, \"thead\", 12)(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Transaction ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Amount\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Status\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Payer Username\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\");\n    i0.ɵɵtext(14, \"Payer Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"th\");\n    i0.ɵɵtext(16, \"Payer Mobile\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"th\");\n    i0.ɵɵtext(18, \"Action\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(19, \"tbody\");\n    i0.ɵɵtemplate(20, LevelDataComponent_div_3_ng_template_6_tr_20_Template, 19, 14, \"tr\", 13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(20);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r4.levelDetails);\n  }\n}\nfunction LevelDataComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4)(1, \"div\", 5)(2, \"h5\", 6);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\", 7);\n    i0.ɵɵtemplate(5, LevelDataComponent_div_3_div_5_Template, 3, 0, \"div\", 8);\n    i0.ɵɵtemplate(6, LevelDataComponent_div_3_ng_template_6_Template, 21, 1, \"ng-template\", null, 9, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const _r3 = i0.ɵɵreference(7);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Level \", ctx_r0.levelData.level, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.levelDetails)(\"ngIfElse\", _r3);\n  }\n}\nfunction LevelDataComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\", 10);\n    i0.ɵɵtext(2, \"No level data available.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let LevelDataComponent = /*#__PURE__*/(() => {\n  class LevelDataComponent {\n    constructor(route, http) {\n      this.route = route;\n      this.http = http;\n      this.levelDetails = [];\n      this.currentPage = 1;\n      this.itemsPerPage = 10; // Adjust as needed\n      this.loading = false;\n      this.endOfData = false;\n    }\n    ngOnInit() {\n      this.levelData = history.state.levelData;\n      if (this.levelData) {\n        this.fetchLevelDetails(this.levelData.level);\n      }\n    }\n    fetchLevelDetails(level) {\n      if (this.loading || this.endOfData) {\n        return;\n      }\n      this.loading = true;\n      const payerId = localStorage.getItem('_id');\n      if (!payerId) {\n        console.error('PayerId not found in localStorage');\n        return;\n      }\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      });\n      const params = {\n        page: this.currentPage.toString(),\n        limit: this.itemsPerPage.toString()\n      };\n      this.http.get(`${environment.apiUrl}/payments/transactions/sender/${payerId}/${level}`, {\n        headers,\n        params\n      }).subscribe(response => {\n        if (response.length > 0) {\n          this.levelDetails = [...this.levelDetails, ...response].sort((a, b) => a.status === 'pending' ? -1 : 1);\n          this.currentPage++;\n        } else {\n          this.endOfData = true;\n        }\n        this.loading = false;\n      }, error => {\n        console.error('Error fetching matrix summary:', error);\n        this.loading = false;\n      });\n    }\n    confirmPayment(transactionId) {\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      });\n      this.http.put(`${environment.apiUrl}/payments/transactions/done/${transactionId}`, {}, {\n        headers\n      }).subscribe(response => {\n        console.log('Payment confirmed:', response);\n        this.levelDetails = this.levelDetails.map(transaction => transaction._id === transactionId ? {\n          ...transaction,\n          status: 'paid'\n        } : transaction);\n      }, error => {\n        console.error('Error confirming payment:', error);\n      });\n    }\n    onScroll(event) {\n      if (window.innerHeight + window.scrollY >= document.body.offsetHeight) {\n        this.fetchLevelDetails(this.levelData.level);\n      }\n    }\n    static #_ = this.ɵfac = function LevelDataComponent_Factory(t) {\n      return new (t || LevelDataComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.HttpClient));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: LevelDataComponent,\n      selectors: [[\"app-level-data\"]],\n      hostBindings: function LevelDataComponent_HostBindings(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵlistener(\"scroll\", function LevelDataComponent_scroll_HostBindingHandler($event) {\n            return ctx.onScroll($event);\n          }, false, i0.ɵɵresolveWindow);\n        }\n      },\n      decls: 5,\n      vars: 2,\n      consts: [[1, \"container\", \"mt-5\"], [1, \"text-center\", \"mb-4\"], [\"class\", \"card mb-4\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"card\", \"mb-4\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"card-body\"], [4, \"ngIf\", \"ngIfElse\"], [\"details\", \"\"], [1, \"text-center\"], [1, \"table\", \"table-bordered\", \"table-hover\"], [1, \"thead-dark\"], [4, \"ngFor\", \"ngForOf\"], [\"class\", \"btn btn-success\", 3, \"click\", 4, \"ngIf\"], [1, \"btn\", \"btn-success\", 3, \"click\"]],\n      template: function LevelDataComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\", 1);\n          i0.ɵɵtext(2, \"Level Data\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(3, LevelDataComponent_div_3_Template, 8, 3, \"div\", 2);\n          i0.ɵɵtemplate(4, LevelDataComponent_div_4_Template, 3, 0, \"div\", 3);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.levelData);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", !ctx.levelData);\n        }\n      },\n      dependencies: [i3.NgForOf, i3.NgIf, i3.CurrencyPipe, i3.DatePipe]\n    });\n  }\n  return LevelDataComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}