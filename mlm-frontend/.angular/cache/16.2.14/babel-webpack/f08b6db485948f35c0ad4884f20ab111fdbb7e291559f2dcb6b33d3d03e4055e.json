{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { environment } from 'src/environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nconst _c0 = [\"paymentModal\"];\nfunction PmfComponent_div_5_button_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function PmfComponent_div_5_button_9_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const transaction_r2 = i0.ɵɵnextContext().$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.openModal(transaction_r2._id));\n    });\n    i0.ɵɵtext(1, \" Pay \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PmfComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 17)(1, \"div\", 18)(2, \"p\", 19);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 19);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 19);\n    i0.ɵɵtext(7);\n    i0.ɵɵpipe(8, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(9, PmfComponent_div_5_button_9_Template, 2, 0, \"button\", 20);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const transaction_r2 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Amount: \\u20B9\", transaction_r2.amount, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Status: \", transaction_r2.status, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Date: \", i0.ɵɵpipeBind2(8, 4, transaction_r2.date, \"medium\"), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", transaction_r2.status === \"open\");\n  }\n}\nfunction PmfComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3)(1, \"div\", 22)(2, \"span\", 23);\n    i0.ɵɵtext(3, \"Loading...\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nexport let PmfComponent = /*#__PURE__*/(() => {\n  class PmfComponent {\n    constructor(http) {\n      this.http = http;\n      this.levelDetails = [];\n      this.currentPage = 1;\n      this.itemsPerPage = 10;\n      this.loading = false;\n      this.endOfData = false;\n      this.transactionId = '';\n    }\n    ngOnInit() {\n      this.levelData = history.state.levelData;\n      this.fetchLevelDetails();\n    }\n    onScroll() {\n      if (window.innerHeight + window.scrollY >= document.body.offsetHeight && !this.loading && !this.endOfData) {\n        this.currentPage++;\n        this.fetchLevelDetails();\n      }\n    }\n    fetchLevelDetails() {\n      if (this.loading) {\n        return;\n      }\n      const payerId = localStorage.getItem('_id');\n      if (!payerId) {\n        console.error('PayerId not found in localStorage');\n        return;\n      }\n      this.loading = true;\n      const headers = new HttpHeaders({\n        'Authorization': `Bearer ${localStorage.getItem('token')}`\n      });\n      this.http.get(`${environment.apiUrl}/payments/getTransactionsPMF/${payerId}?page=${this.currentPage}&limit=${this.itemsPerPage}`, {\n        headers\n      }).subscribe(response => {\n        this.levelDetails = [...this.levelDetails, ...response.transactions];\n        if (response.currentPage >= response.totalPages) {\n          this.endOfData = true;\n        }\n        this.loading = false;\n      }, error => {\n        console.error('Error fetching matrix summary:', error);\n        this.loading = false;\n      });\n    }\n    openModal(transactionId) {\n      this.transactionId = transactionId;\n    }\n    confirmPayment() {\n      if (this.transactionId != '') {\n        const headers = new HttpHeaders({\n          'Authorization': `Bearer ${localStorage.getItem('token')}`\n        });\n        this.http.put(`${environment.apiUrl}/payments/transactions/payPMF/${this.transactionId}/${this.epin}`, {}, {\n          headers\n        }).subscribe(response => {\n          alert(response.message);\n          this.levelDetails = this.levelDetails.map(transaction => transaction._id === this.transactionId ? {\n            ...transaction,\n            status: 'paid'\n          } : transaction);\n        }, error => {\n          console.error('Error confirming payment:', error);\n        });\n      }\n    }\n    static #_ = this.ɵfac = function PmfComponent_Factory(t) {\n      return new (t || PmfComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: PmfComponent,\n      selectors: [[\"app-pmf\"]],\n      viewQuery: function PmfComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.paymentModal = _t.first);\n        }\n      },\n      hostBindings: function PmfComponent_HostBindings(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵlistener(\"scroll\", function PmfComponent_scroll_HostBindingHandler($event) {\n            return ctx.onScroll($event);\n          }, false, i0.ɵɵresolveWindow);\n        }\n      },\n      decls: 21,\n      vars: 3,\n      consts: [[1, \"container\", \"mt-4\"], [1, \"row\"], [1, \"col-12\"], [1, \"text-center\"], [\"class\", \"card mb-3\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-center\", 4, \"ngIf\"], [\"id\", \"exampleModal\", \"tabindex\", \"-1\", \"aria-labelledby\", \"exampleModalLabel\", \"aria-hidden\", \"true\", 1, \"modal\", \"fade\"], [1, \"modal-dialog\"], [1, \"modal-content\"], [1, \"modal-header\"], [\"id\", \"exampleModalLabel\", 1, \"modal-title\", \"fs-5\"], [\"type\", \"button\", \"data-bs-dismiss\", \"modal\", \"aria-label\", \"Close\", 1, \"btn-close\"], [1, \"modal-body\"], [\"type\", \"text\", \"placeholder\", \"Enter Epin\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"modal-footer\"], [\"type\", \"button\", \"data-bs-dismiss\", \"modal\", 1, \"btn\", \"btn-secondary\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"card\", \"mb-3\"], [1, \"card-body\"], [1, \"card-text\"], [\"type\", \"button\", \"class\", \"btn btn-primary\", \"data-bs-toggle\", \"modal\", \"data-bs-target\", \"#exampleModal\", 3, \"click\", 4, \"ngIf\"], [\"type\", \"button\", \"data-bs-toggle\", \"modal\", \"data-bs-target\", \"#exampleModal\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [\"role\", \"status\", 1, \"spinner-border\"], [1, \"visually-hidden\"]],\n      template: function PmfComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h2\", 3);\n          i0.ɵɵtext(4, \"PMF Transactions\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(5, PmfComponent_div_5_Template, 10, 7, \"div\", 4);\n          i0.ɵɵtemplate(6, PmfComponent_div_6_Template, 4, 0, \"div\", 5);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(7, \"div\", 6)(8, \"div\", 7)(9, \"div\", 8)(10, \"div\", 9)(11, \"h1\", 10);\n          i0.ɵɵtext(12, \"Pay PMF\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(13, \"button\", 11);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"div\", 12)(15, \"input\", 13);\n          i0.ɵɵlistener(\"ngModelChange\", function PmfComponent_Template_input_ngModelChange_15_listener($event) {\n            return ctx.epin = $event;\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(16, \"div\", 14)(17, \"button\", 15);\n          i0.ɵɵtext(18, \"Close\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"button\", 16);\n          i0.ɵɵlistener(\"click\", function PmfComponent_Template_button_click_19_listener() {\n            return ctx.confirmPayment();\n          });\n          i0.ɵɵtext(20, \"Save changes\");\n          i0.ɵɵelementEnd()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", ctx.levelDetails);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngModel\", ctx.epin);\n        }\n      },\n      dependencies: [i2.NgForOf, i2.NgIf, i3.DefaultValueAccessor, i3.NgControlStatus, i3.NgModel, i2.DatePipe]\n    });\n  }\n  return PmfComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}